# Pinstack 構築・仕様ガイド

## 構成
- TypeScriptのソースは`src/`にあり、ビルド後は`dist/`に出力されます。
- HTML/CSS/manifestなどの静的ファイルも`dist/`にコピーされます。

## ビルド
```bash
bun install
bun run build
```

## Chromeへの読み込み（開発用）
1. `chrome://extensions`を開きます。
2. **デベロッパーモード**を有効にします。
3. **パッケージ化されていない拡張機能を読み込む**をクリックし、`dist/`を選択します。

## 権限
- `tabs`: ピン留めタブの取得と復元に使用します。
- `storage`: `chrome.storage.sync`でグループを保存・同期するために使用します。

## 仕様
- 起動時にユーザーのデフォルトピン留めグループを必ず保持し、存在しない場合は`nanoid`でIDを採番して生成します。
- 同期先グループが未指定の場合はユーザーのデフォルトピン留めグループに同期します。
- 初回利用の環境で既にピン留めがある場合は、名称未設定のグループを自動作成して同期先にします。
- ピン留め状態になったタブは自動的に同期され、ピン留め/解除の変更も自動で反映されます。
- 新しいグループはユーザーが動的に作成でき、選択されたグループが指定された場合はデフォルトではなくそのグループへ同期されます。
- すでに保存済みのデータがある場合は復元も行います。
- 他端末では新しく同期された内容がリアルタイムに再現されます。

## バイブコーディング計画
### フェーズ1: 方向性と要件の言語化
- ユーザー視点の体験を短文で言語化し、成功条件を明確にする
- 既存仕様と追加要件のギャップを整理する

### フェーズ2: データ設計と同期戦略
- グループ/ピン情報のデータモデルを確定する
- どのイベントで同期を走らせるかを決める（Pin/UnPin、グループ選択、初回起動）
- 競合時の扱い（最新優先など）を決める

### フェーズ3: UI/UXの流れ設計
- ポップアップでの操作導線（保存、既定設定、削除、選択）を整理する
- 初回利用時の自動グループ作成と同期先の挙動を明文化する

### フェーズ4: 実装
- ストレージ層（sync/local）の更新
- バックグラウンドイベントの同期処理を追加
- ポップアップ側の表示/操作を連動

### フェーズ5: 検証
- 新規環境での初回挙動を確認する
- 端末間同期の再現性を確認する
- Pin/UnPinの自動同期と復元を確認する

### フェーズ6: 仕上げ
- ドキュメント更新
- 既存利用者への影響確認
